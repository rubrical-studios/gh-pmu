# Configuration Guide

gh-pmu uses a `.gh-pmu.yml` file in your repository root to configure project connections, field aliases, and triage rules.

## Quick Setup

Run the interactive setup:

```bash
gh pmu init
```

This creates `.gh-pmu.yml` with your project settings and fetches field metadata.

## Configuration Reference

### Project Settings

```yaml
project:
  name: my-project       # Display name
  owner: your-username   # GitHub user or org
  number: 1              # Project number (from URL)
```

### Repositories

List repositories that use this project board:

```yaml
repositories:
  - your-username/repo-one
  - your-username/repo-two
```

### Defaults

Default values applied when creating issues:

```yaml
defaults:
  priority: p2           # Default priority alias
  status: backlog        # Default status alias
  labels:
    - enhancement        # Labels added to all new issues (optional)
```

### Field Aliases

Map short aliases to actual project field values. Use aliases in commands instead of full field names:

```yaml
fields:
  priority:
    field: Priority      # Actual field name in project
    values:
      p0: P0             # alias: Actual Value
      p1: P1
      p2: P2
  status:
    field: Status
    values:
      backlog: Backlog
      ready: Ready
      in_progress: In progress
      in_review: In review
      done: Done
```

**Usage:**
```bash
# Use alias (lowercase, underscore)
gh pmu move 42 --status in_progress --priority p1

# Instead of actual values
gh pmu move 42 --status "In progress" --priority "P1"
```

### Triage Rules

Define rules for batch processing issues:

```yaml
triage:
  # Rule name
  untracked:
    # GitHub search query
    query: "is:issue is:open -label:triaged"

    # Fields/labels to apply automatically
    apply:
      labels:
        - triaged
      fields:
        status: backlog
        priority: p2

    # Fields to prompt for interactively
    interactive:
      status: true
      priority: false

  # Another rule example
  stale:
    query: "is:issue is:open updated:<2024-01-01"
    apply:
      labels:
        - needs-triage
```

**Usage:**
```bash
# Preview what would be affected
gh pmu triage untracked --dry-run

# Apply the rule
gh pmu triage untracked --apply
```

### Release Configuration

Configure release and patch workflows:

```yaml
release:
  # Artifact generation settings
  artifacts:
    directory: Releases           # Base directory (default: "Releases")
    release_notes: true           # Generate release-notes.md
    changelog: true               # Generate changelog.md

  # Track definitions
  tracks:
    - name: main                  # Track name
      prefix: ""                  # Artifact directory prefix (empty = version only)
    - name: lts
      prefix: lts-               # Artifacts go to "lts-v1.2.0/"

  # Active releases (auto-synced by init)
  active:
    - version: "1.2.0"
      track: main
      tracker_issue: 42

  # Coverage gate settings (for /prepare-release workflow)
  coverage:
    enabled: true              # Enable coverage gate (default: true)
    threshold: 80              # Minimum patch coverage % (default: 80)
    skip_patterns:             # Patterns to exclude from analysis
      - "*_test.go"
      - "mock_*.go"
```

**Notes:**
- `gh pmu init` auto-creates Release/Microsprint fields and labels if missing
- Coverage gate runs during `/prepare-release` to catch test coverage gaps before release
- Set `enabled: false` to disable the coverage gate
- Active releases are synced from tracker issues during init
- Track prefix controls artifact directory naming (e.g., `main-v1.2.0/` vs `v1.2.0/`)

### Validation Rules

Configure status transition validation to enforce workflow progressions:

```yaml
validation:
  enabled: true                    # Enable/disable validation
  rules:
    backlog:
      - ready
      - in_progress
    ready:
      - in_progress
      - backlog
    in_progress:
      - in_review
      - ready
      - backlog
    in_review:
      - done
      - in_progress
    done: []                       # No transitions from done by default
```

**Notes:**
- When enabled, `move` command validates status transitions
- Use `gh pmu move --force` to bypass validation when needed
- Use `gh pmu validation rules` to view current rules
- Use `gh pmu validation check <from> <to>` to test transitions

### Metadata (Auto-Generated)

The `metadata` section is auto-generated by `gh pmu init`. Do not edit manually:

```yaml
metadata:
  project:
    id: PVT_xxx          # Project node ID
  fields:
    - name: Status
      id: PVTSSF_xxx
      data_type: SINGLE_SELECT
      options:
        - name: Backlog
          id: abc123
```

To refresh metadata after changing project fields:

```bash
gh pmu init --refresh
```

## Complete Example

```yaml
project:
  name: my-app
  owner: myorg
  number: 5

repositories:
  - myorg/frontend
  - myorg/backend
  - myorg/docs

defaults:
  priority: p2
  status: backlog

fields:
  priority:
    field: Priority
    values:
      p0: P0
      p1: P1
      p2: P2
  status:
    field: Status
    values:
      backlog: Backlog
      ready: Ready
      in_progress: In progress
      in_review: In review
      done: Done
  size:
    field: Size
    values:
      xs: XS
      s: S
      m: M
      l: L
      xl: XL

triage:
  estimate:
    query: "is:issue is:open -has:estimate"
    apply: {}
    interactive:
      estimate: true

metadata:
  # ... auto-generated ...
```

## Tips

- **Commit `.gh-pmu.yml`** to share configuration with your team
- **Use aliases consistently** across your workflow for faster typing
- **Run `init --refresh`** after adding new project fields
- **Multiple triage rules** let you handle different scenarios (untracked, stale, needs-review)

---

## See Also

- [Commands Reference](commands.md) - Full command documentation
- [Workflows Guide](workflows.md) - Microsprint, release, and patch workflows
- [Sub-Issues Guide](sub-issues.md) - Hierarchy management
- [Batch Operations](batch-operations.md) - Intake, triage, split
